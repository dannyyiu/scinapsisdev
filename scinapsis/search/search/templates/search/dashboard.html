{% extends "search/index_base.html" %}

{% block index_css %}
    <link rel="stylesheet" href="/static/css/c3.css">
    <style TYPE="text/css">
    <!--
        .chart-contain {
            padding: 2em;
        }
        .c3-line {
            stroke-width: 3px;
        }
    -->
    </style>
{% endblock %}

{% block search_content %}
<div class="container">
    <div class="headline"><h2>Your search results</h2></div>
        <div class="row">
            <div class="col-md-6 chart-contain">
                <h2 class="text-center">Methods</h2>
                <div id="chart1"></div>
            </div>
            <div class="col-md-6 chart-contain">
                <h2 class="text-center">Impact Factor</h2>
                <div id="chart2"></div>
            </div>
        </div>
</div>
<pre>
{{ data }}
</pre>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="/static/js/c3.min.js"></script>
<script>

var data = {{data|safe}};

var data2 = [
        ["x", 2011,2012,2013,2014],
        ["IF", 1.3, 1.5, 2, 2.1],
        ["IHC", 1.1, 2, 3.1, 4],
        ["WB", 3, 5.5, 7.8, 9]
    ];

slicer1 = function(array) {
  return d3.max(array.slice(1));
};

var color_func = d3.scale.linear()
    .domain([d3.min(data, slicer1), d3.max(data, slicer1)])
    .range(["#6b486b", "#98abc5"]);


var colors = [];

for ( var i in data)
{

    v = data[i][1]
    c = color_func(v)
    console.log(c);
    colors.push(c);
}

var chart1 = c3.generate({
    bindto: '#chart1',
    data: {

        // iris data from R
        columns: data,
        type : 'pie',
        onclick: function (d, i) {
            url = "list?q={{request.q|safe}}&t="+d["name"];
            console.log(url);
            window.location.href=url;
        }
    },
    color: {
        //pattern: ["#98abc5", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]
        pattern: colors
    }
});

var chart2 = c3.generate({
    bindto: '#chart2',
    data: {
        // iris data from R
        x: 'x',
        columns: data2,
        type : 'spline',
        onclick: function (d, i) {
            console.log("onclick", d, i);
        }
    },
    color: {
        //pattern: ["#98abc5", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]
        pattern: colors
    },
    axis: {
        x: {
            label: 'Year'
        },
        y: {
            label: 'Impact Factor'
        }
    }
});

</script>

{% endblock %}

{% block js %}
<script type="text/javascript">
    jQuery(document).ready(function() {
        App.init();
    });
</script>
{% endblock %}